<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple Admin Test - AgentEQ</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: white; }
    .container { max-width: 800px; margin: 0 auto; }
    .test-section { background: #2a2a3e; padding: 20px; margin: 20px 0; border-radius: 10px; }
    button { padding: 10px 20px; margin: 10px; background: #00d4ff; color: black; border: none; border-radius: 5px; cursor: pointer; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
    .modal-content { background: #2a2a3e; padding: 30px; border-radius: 10px; width: 500px; margin: 50px auto; }
    .modal.show { display: block; }
    input, select, textarea { width: 100%; padding: 10px; margin: 5px 0; background: #333; color: white; border: 1px solid #555; border-radius: 5px; }
    .form-group { margin: 15px 0; }
    label { display: block; margin-bottom: 5px; color: #ddd; }
    .notification { padding: 15px; margin: 10px 0; border-radius: 5px; }
    .success { background: #10b981; }
    .error { background: #ef4444; }
    .close { float: right; font-size: 28px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Admin Dashboard Test - Direct Version</h1>
    
    <div class="test-section">
      <h2>Login First</h2>
      <form id="loginForm">
        <input type="email" id="email" placeholder="Email" value="admin@agentiq.com" required>
        <input type="password" id="password" placeholder="Password" value="password" required>
        <button type="submit">Login as Admin</button>
      </form>
      <div id="loginMessage"></div>
    </div>

    <div class="test-section">
      <h2>Add Functions Test</h2>
      <button onclick="openAddEmployeeModal()">Add Employee</button>
      <button onclick="openAddUserModal()">Add User</button>
      <button onclick="openAddPlanModal()">Add Plan</button>
      <button onclick="openAddReviewModal()">Add Review</button>
    </div>

    <div class="test-section">
      <h2>Load Data Test</h2>
      <button onclick="loadStatistics()">Load Statistics</button>
      <button onclick="loadEmployees()">Load Employees</button>
      <button onclick="loadUsers()">Load Users</button>
      <button onclick="loadPlans()">Load Plans</button>
      <div id="dataResults"></div>
    </div>
  </div>

  <!-- Add Employee Modal -->
  <div id="addEmployeeModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addEmployeeModal')">&times;</span>
      <h3>Add New Employee</h3>
      <form id="addEmployeeForm" onsubmit="submitAddEmployee(event)">
        <div class="form-group">
          <label>First Name</label>
          <input type="text" name="first_name" required>
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" name="last_name" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" name="password" required minlength="8">
        </div>
        <button type="submit">Add Employee</button>
        <button type="button" onclick="closeModal('addEmployeeModal')">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Add User Modal -->
  <div id="addUserModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addUserModal')">&times;</span>
      <h3>Add New User</h3>
      <form id="addUserForm" onsubmit="submitAddUser(event)">
        <div class="form-group">
          <label>First Name</label>
          <input type="text" name="first_name" required>
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" name="last_name" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" name="password" required minlength="8">
        </div>
        <div class="form-group">
          <label>Role</label>
          <select name="role" required>
            <option value="customer">Customer</option>
            <option value="employee">Employee</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <button type="submit">Add User</button>
        <button type="button" onclick="closeModal('addUserModal')">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Add Plan Modal -->
  <div id="addPlanModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addPlanModal')">&times;</span>
      <h3>Add New Plan</h3>
      <form id="addPlanForm" onsubmit="submitAddPlan(event)">
        <div class="form-group">
          <label>Plan Name</label>
          <input type="text" name="name" required>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea name="description" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>Price</label>
          <input type="number" name="price" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Billing Period</label>
          <select name="billing_period" required>
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
        <div class="form-group">
          <label>Max Conversations</label>
          <input type="number" name="max_conversations" placeholder="Leave empty for unlimited">
        </div>
        <button type="submit">Add Plan</button>
        <button type="button" onclick="closeModal('addPlanModal')">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Add Review Modal -->
  <div id="addReviewModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addReviewModal')">&times;</span>
      <h3>Add New Review</h3>
      <form id="addReviewForm" onsubmit="submitAddReview(event)">
        <div class="form-group">
          <label>Customer Name</label>
          <input type="text" name="name" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email">
        </div>
        <div class="form-group">
          <label>Rating</label>
          <select name="rating" required>
            <option value="5">5 Stars</option>
            <option value="4">4 Stars</option>
            <option value="3">3 Stars</option>
            <option value="2">2 Stars</option>
            <option value="1">1 Star</option>
          </select>
        </div>
        <div class="form-group">
          <label>Title</label>
          <input type="text" name="title">
        </div>
        <div class="form-group">
          <label>Review Content</label>
          <textarea name="content" rows="4" required></textarea>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="is_approved" checked>
            Approve Review
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" name="is_featured">
            Feature Review
          </label>
        </div>
        <button type="submit">Add Review</button>
        <button type="button" onclick="closeModal('addReviewModal')">Cancel</button>
      </form>
    </div>
  </div>

  <script>
    // API Configuration
    const API_BASE = `${window.location.origin}/backend/api`;

    // Utility Functions
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 5000);
      console.log(`${type.toUpperCase()}: ${message}`);
    }

    async function apiCall(endpoint, options = {}) {
      try {
        console.log('API Call:', endpoint, options);
        const response = await fetch(`${API_BASE}/${endpoint}`, {
          credentials: 'include',
          headers: { 'Content-Type': 'application/json' },
          ...options
        });
        
        const data = await response.json();
        console.log('API Response:', data);
        
        if (!response.ok) {
          throw new Error(data.error || `HTTP ${response.status}`);
        }
        
        return data;
      } catch (error) {
        console.error('API Error:', error);
        throw error;
      }
    }

    // Login Function
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      try {
        const data = await apiCall('auth/login.php', {
          method: 'POST',
          body: JSON.stringify({ email, password })
        });
        
        if (data.user) {
          document.getElementById('loginMessage').innerHTML = 
            `<div class="notification success">✅ Logged in as ${data.user.first_name} ${data.user.last_name} (${data.user.role})</div>`;
          showNotification(`Logged in successfully as ${data.user.role}`, 'success');
        }
      } catch (error) {
        document.getElementById('loginMessage').innerHTML = 
          `<div class="notification error">❌ Login failed: ${error.message}</div>`;
        showNotification(`Login failed: ${error.message}`, 'error');
      }
    });

    // Modal Functions
    function openAddEmployeeModal() {
      console.log('Opening employee modal');
      document.getElementById('addEmployeeModal').classList.add('show');
    }

    function openAddUserModal() {
      console.log('Opening user modal');
      document.getElementById('addUserModal').classList.add('show');
    }

    function openAddPlanModal() {
      console.log('Opening plan modal');
      document.getElementById('addPlanModal').classList.add('show');
    }

    function openAddReviewModal() {
      console.log('Opening review modal');
      document.getElementById('addReviewModal').classList.add('show');
    }

    function closeModal(modalId) {
      console.log('Closing modal:', modalId);
      document.getElementById(modalId).classList.remove('show');
    }

    // Form Submission Functions
    async function submitAddEmployee(event) {
      event.preventDefault();
      console.log('Submitting employee form');
      
      const formData = new FormData(event.target);
      const employeeData = {
        first_name: formData.get('first_name'),
        last_name: formData.get('last_name'),
        email: formData.get('email'),
        password: formData.get('password')
      };

      try {
        const result = await apiCall('admin/add-employee.php', {
          method: 'POST',
          body: JSON.stringify(employeeData)
        });
        
        showNotification('Employee added successfully!', 'success');
        closeModal('addEmployeeModal');
        event.target.reset();
      } catch (error) {
        showNotification(`Failed to add employee: ${error.message}`, 'error');
      }
    }

    async function submitAddUser(event) {
      event.preventDefault();
      console.log('Submitting user form');
      
      const formData = new FormData(event.target);
      const userData = {
        first_name: formData.get('first_name'),
        last_name: formData.get('last_name'),
        email: formData.get('email'),
        password: formData.get('password'),
        role: formData.get('role')
      };

      try {
        const result = await apiCall('admin/add-user.php', {
          method: 'POST',
          body: JSON.stringify(userData)
        });
        
        showNotification('User added successfully!', 'success');
        closeModal('addUserModal');
        event.target.reset();
      } catch (error) {
        showNotification(`Failed to add user: ${error.message}`, 'error');
      }
    }

    async function submitAddPlan(event) {
      event.preventDefault();
      console.log('Submitting plan form');
      
      const formData = new FormData(event.target);
      const planData = {
        name: formData.get('name'),
        description: formData.get('description'),
        price: parseFloat(formData.get('price')),
        billing_period: formData.get('billing_period'),
        max_conversations: formData.get('max_conversations') ? parseInt(formData.get('max_conversations')) : null,
        features: ["Basic Features"]
      };

      try {
        const result = await apiCall('admin/add-plan.php', {
          method: 'POST',
          body: JSON.stringify(planData)
        });
        
        showNotification('Plan added successfully!', 'success');
        closeModal('addPlanModal');
        event.target.reset();
      } catch (error) {
        showNotification(`Failed to add plan: ${error.message}`, 'error');
      }
    }

    async function submitAddReview(event) {
      event.preventDefault();
      console.log('Submitting review form');
      
      const formData = new FormData(event.target);
      const reviewData = {
        name: formData.get('name'),
        email: formData.get('email'),
        rating: parseInt(formData.get('rating')),
        title: formData.get('title'),
        content: formData.get('content'),
        is_approved: formData.get('is_approved') ? 1 : 0,
        is_featured: formData.get('is_featured') ? 1 : 0
      };

      try {
        const result = await apiCall('admin/add-review.php', {
          method: 'POST',
          body: JSON.stringify(reviewData)
        });
        
        showNotification('Review added successfully!', 'success');
        closeModal('addReviewModal');
        event.target.reset();
      } catch (error) {
        showNotification(`Failed to add review: ${error.message}`, 'error');
      }
    }

    // Data Loading Functions
    async function loadStatistics() {
      try {
        const data = await apiCall('admin/get-statistics.php');
        document.getElementById('dataResults').innerHTML = 
          `<div class="notification success">Statistics loaded: ${JSON.stringify(data.statistics?.overview || {}, null, 2)}</div>`;
      } catch (error) {
        document.getElementById('dataResults').innerHTML = 
          `<div class="notification error">Failed to load statistics: ${error.message}</div>`;
      }
    }

    async function loadEmployees() {
      try {
        const data = await apiCall('admin/get-employees.php');
        document.getElementById('dataResults').innerHTML = 
          `<div class="notification success">Employees loaded: ${data.employees?.length || 0} employees found</div>`;
      } catch (error) {
        document.getElementById('dataResults').innerHTML = 
          `<div class="notification error">Failed to load employees: ${error.message}</div>`;
      }
    }

    async function loadUsers() {
      try {
        const data = await apiCall('admin/get-users.php');
        document.getElementById('dataResults').innerHTML = 
          `<div class="notification success">Users loaded: ${data.users?.length || 0} users found</div>`;
      } catch (error) {
        document.getElementById('dataResults').innerHTML = 
          `<div class="notification error">Failed to load users: ${error.message}</div>`;
      }
    }

    async function loadPlans() {
      try {
        const data = await apiCall('admin/get-plans.php');
        document.getElementById('dataResults').innerHTML = 
          `<div class="notification success">Plans loaded: ${data.plans?.length || 0} plans found</div>`;
      } catch (error) {
        document.getElementById('dataResults').innerHTML = 
          `<div class="notification error">Failed to load plans: ${error.message}</div>`;
      }
    }
  </script>
</body>
</html>
